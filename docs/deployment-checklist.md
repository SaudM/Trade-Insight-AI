# 生产环境部署检查清单

在将Trade Insight AI部署到生产环境之前，请确保完成以下所有检查项。

## ✅ 环境配置检查

### 必需的环境变量
- [ ] `NODE_ENV=production`
- [ ] `ENABLE_PRESET_DATA=false` ⚠️ **关键：禁用测试数据**
- [ ] `DATABASE_URL` 设置为生产数据库
- [ ] `NEXTAUTH_SECRET` 设置强密码
- [ ] `NEXTAUTH_URL` 设置为生产域名

### Firebase配置
- [ ] `FIREBASE_PROJECT_ID` 设置为生产项目
- [ ] `FIREBASE_PRIVATE_KEY` 设置正确
- [ ] `FIREBASE_CLIENT_EMAIL` 设置正确
- [ ] Firebase项目已启用Authentication

### 支付配置（如果使用）
- [ ] 微信支付配置（生产环境密钥）
- [ ] 支付宝配置（生产环境密钥）
- [ ] 支付回调URL设置正确

## 🗄️ 数据库配置检查

### 数据库初始化
- [ ] 生产数据库已创建
- [ ] 数据库用户权限配置正确
- [ ] SSL连接已启用
- [ ] 运行 `npx prisma migrate deploy`
- [ ] 运行 `npx prisma generate`

### 数据安全
- [ ] **确认未运行种子脚本** (`npm run db:seed`)
- [ ] **确认无测试用户数据**
- [ ] 数据库备份策略已设置
- [ ] 数据库访问日志已启用

## 🔒 安全配置检查

### 应用安全
- [ ] 所有敏感信息使用环境变量
- [ ] CORS配置正确
- [ ] 速率限制已启用
- [ ] HTTPS已配置

### 密钥管理
- [ ] 数据库密码足够强
- [ ] API密钥定期轮换
- [ ] 不在代码中硬编码密钥
- [ ] 环境变量安全存储

## 🚀 部署配置检查

### 构建配置
- [ ] `npm run build` 成功执行
- [ ] 静态资源正确生成
- [ ] Prisma客户端正确生成
- [ ] 无TypeScript错误

### 容器配置（如果使用Docker）
- [ ] Dockerfile使用production阶段
- [ ] 环境变量正确传递
- [ ] 端口映射正确
- [ ] 健康检查配置

### 服务配置
- [ ] 负载均衡器配置
- [ ] 域名DNS配置
- [ ] SSL证书配置
- [ ] CDN配置（如果使用）

## 🧪 功能测试检查

### 用户注册流程
- [ ] 新用户可以正常注册
- [ ] **新用户数据面板为空**（无示例数据）
- [ ] 用户可以添加真实交易数据
- [ ] 用户可以生成真实分析报告

### 支付流程（如果使用）
- [ ] 支付页面正常显示
- [ ] 支付流程完整测试
- [ ] 支付回调正常处理
- [ ] 订阅状态正确更新

### 数据功能
- [ ] 交易日志CRUD功能正常
- [ ] 日分析报告生成正常
- [ ] 周报月报生成正常
- [ ] 数据导出功能正常

## 📊 监控配置检查

### 应用监控
- [ ] 错误监控（如Sentry）已配置
- [ ] 性能监控已配置
- [ ] 日志聚合已配置
- [ ] 健康检查端点已配置

### 数据库监控
- [ ] 数据库性能监控
- [ ] 连接池监控
- [ ] 慢查询监控
- [ ] 存储空间监控

## 🔍 部署后验证

### 立即验证
- [ ] 应用正常启动
- [ ] 健康检查通过
- [ ] 数据库连接正常
- [ ] 静态资源加载正常

### 功能验证
- [ ] 用户注册功能正常
- [ ] 登录功能正常
- [ ] 核心业务功能正常
- [ ] 支付功能正常（如果使用）

### 数据验证
- [ ] **确认无测试数据泄露**
- [ ] 新用户数据面板为空
- [ ] 数据持久化正常
- [ ] 缓存功能正常

## ⚠️ 关键注意事项

### 测试数据控制
1. **绝对禁止**在生产环境运行以下命令：
   ```bash
   npm run db:seed      # 创建测试数据
   npm run db:reset     # 重置数据库
   ```

2. **必须确保**环境变量设置：
   ```bash
   ENABLE_PRESET_DATA=false
   ```

3. **验证方法**：
   - 注册新用户
   - 检查用户数据面板是否为空
   - 查看应用日志，确认无"创建预设数据"信息

### 回滚计划
- [ ] 数据库备份已创建
- [ ] 回滚脚本已准备
- [ ] 回滚流程已测试
- [ ] 团队成员了解回滚步骤

## 📞 紧急联系

部署过程中如遇问题，请联系：
- 技术负责人：[联系方式]
- 数据库管理员：[联系方式]
- 运维团队：[联系方式]

---

**重要提醒**：请在生产部署前逐项检查此清单，确保所有项目都已完成。特别注意测试数据相关的配置，避免在生产环境中泄露测试数据。