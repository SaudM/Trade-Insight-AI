
{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the application with multi-tenancy support.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "name": {
          "type": "string",
          "description": "User's full name."
        },
        "googleId": {
          "type": "string",
          "description": "User's Google ID, if they signed up with Google."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp of when the user account was created.",
          "format": "date-time"
        },
        "subscription": {
          "$ref": "#/backend/entities/Subscription",
          "description": "The user's current subscription details."
        }
      },
      "required": [
        "id",
        "email",
        "name",
        "createdAt"
      ]
    },
    "TradeLog": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "TradeLog",
      "type": "object",
      "description": "Represents a single trade log entry.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the TradeLog entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N TradeLog)"
        },
        "tradeTime": {
          "type": "string",
          "description": "Timestamp of the trade execution.",
          "format": "date-time"
        },
        "symbol": {
          "type": "string",
          "description": "Stock symbol or asset name."
        },
        "direction": {
          "type": "string",
          "description": "Direction of the trade (Buy/Sell/Long/Short)."
        },
        "positionSize": {
          "type": "number",
          "description": "Position size (percentage or number of shares)."
        },
        "entryReason": {
          "type": "string",
          "description": "Reason for entering the trade."
        },
        "exitReason": {
          "type": "string",
          "description": "Reason for exiting the trade."
        },
        "tradeResult": {
          "type": "number",
          "description": "Profit or loss from the trade."
        },
        "emotionalState": {
          "type": "string",
          "description": "Emotional state during the trade (e.g., calm, anxious)."
        },
        "lessonsLearned": {
          "type": "string",
          "description": "Lessons learned from the trade."
        }
      },
      "required": [
        "id",
        "userId",
        "tradeTime",
        "symbol",
        "direction",
        "positionSize",
        "tradeResult"
      ]
    },
    "DailyAnalysis": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "DailyAnalysis",
      "type": "object",
      "description": "Represents the daily analysis report generated by AI.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the DailyAnalysis entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N DailyAnalysis)"
        },
        "date": {
          "type": "string",
          "description": "Date of the analysis.",
          "format": "date-time"
        },
        "summary": {
          "type": "string",
          "description": "Summary of the day's trading activity."
        },
        "strengths": {
          "type": "string",
          "description": "Identified strengths in the trading process."
        },
        "weaknesses": {
          "type": "string",
          "description": "Identified weaknesses in the trading process."
        },
        "emotionalImpact": {
          "type": "string",
          "description": "Analysis of how emotional state impacted decisions."
        },
        "improvementSuggestions": {
          "type": "string",
          "description": "Suggestions for improvement."
        }
      },
      "required": [
        "id",
        "userId",
        "date",
        "summary"
      ]
    },
    "WeeklyReview": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "WeeklyReview",
      "type": "object",
      "description": "Represents the weekly review and pattern discovery.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the WeeklyReview entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N WeeklyReview)"
        },
        "startDate": {
          "type": "string",
          "description": "Start date of the week being reviewed.",
          "format": "date-time"
        },
        "endDate": {
          "type": "string",
          "description": "End date of the week being reviewed.",
          "format": "date-time"
        },
        "patternSummary": {
          "type": "string",
          "description": "Summary of trading patterns."
        },
        "errorPatterns": {
          "type": "string",
          "description": "Common error patterns identified."
        },
        "successPatterns": {
          "type": "string",
          "description": "Successful trading patterns identified."
        },
        "positionSizingAnalysis": {
          "type": "string",
          "description": "Analysis of position sizing effectiveness."
        },
        "emotionalCorrelation": {
          "type": "string",
          "description": "Correlation between emotional state and trading results."
        }
      },
      "required": [
        "id",
        "userId",
        "startDate",
        "endDate"
      ]
    },
    "WeeklyImprovementPlan": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "WeeklyImprovementPlan",
      "type": "object",
      "description": "Represents the weekly improvement plan generated by AI.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the WeeklyImprovementPlan entity."
        },
        "weeklyReviewId": {
          "type": "string",
          "description": "Reference to WeeklyReview. (Relationship: WeeklyReview 1:1 WeeklyImprovementPlan)"
        },
        "planSummary": {
          "type": "string",
          "description": "Summary of the weekly improvement plan."
        },
        "actionableSteps": {
          "type": "string",
          "description": "Actionable steps for the trader to follow."
        }
      },
      "required": [
        "id",
        "weeklyReviewId",
        "planSummary",
        "actionableSteps"
      ]
    },
    "MonthlySummary": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "MonthlySummary",
      "type": "object",
      "description": "Represents the monthly summary and system optimization report.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the MonthlySummary entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N MonthlySummary)"
        },
        "monthStartDate": {
          "type": "string",
          "description": "Start date of the month being summarized.",
          "format": "date-time"
        },
        "monthEndDate": {
          "type": "string",
          "description": "End date of the month being summarized.",
          "format": "date-time"
        },
        "performanceComparison": {
          "type": "string",
          "description": "Comparison of current month's performance with the previous month."
        },
        "recurringIssues": {
          "type": "string",
          "description": "Recurring issues identified in the trading system."
        },
        "strategyExecutionAssessment": {
          "type": "string",
          "description": "Assessment of strategy execution and discipline."
        },
        "keyLessons": {
          "type": "string",
          "description": "Key lessons learned during the month."
        },
        "iterationSuggestions": {
          "type": "string",
          "description": "Specific and actionable iteration suggestions."
        }
      },
      "required": [
        "id",
        "userId",
        "monthStartDate",
        "monthEndDate"
      ]
    },
    "Subscription": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Subscription",
      "type": "object",
      "description": "Represents a user's subscription to a plan.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Subscription entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to the User."
        },
        "planId": {
          "type": "string",
          "enum": ["monthly", "quarterly", "semi_annually", "annually"],
          "description": "The subscribed plan identifier."
        },
        "status": {
          "type": "string",
          "enum": ["active", "inactive", "cancelled", "trialing"],
          "description": "The current status of the subscription."
        },
        "startDate": {
          "type": "string",
          "format": "date-time",
          "description": "The start date of the subscription period."
        },
        "endDate": {
          "type": "string",
          "format": "date-time",
          "description": "The end date of the subscription period."
        },
        "paymentProvider": {
          "type": "string",
          "enum": ["wechat_pay", "alipay", "stripe"],
          "description": "The payment provider used for the transaction."
        },
        "paymentId": {
          "type": "string",
          "description": "The transaction ID from the payment provider."
        }
      },
      "required": ["id", "userId", "planId", "status", "startDate", "endDate"]
    }
  },
  "auth": {
    "providers": [
      "password",
      "google.com"
    ],
    "authorizedDomains": [
      "localhost"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile information. Path-based ownership enforced via security rules.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user. Corresponds to the Firebase auth UID."
            }
          ]
        }
      },
       {
        "path": "/users/{userId}/subscription/current",
        "definition": {
          "entityName": "Subscription",
          "schema": {
            "$ref": "#/backend/entities/Subscription"
          },
          "description": "Stores the user's current subscription details as a single document for easy access.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/tradeLogs/{tradeLogId}",
        "definition": {
          "entityName": "TradeLog",
          "schema": {
            "$ref": "#/backend/entities/TradeLog"
          },
          "description": "Stores individual trade log entries for a given user. Path-based ownership enforced via security rules.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user. Corresponds to the Firebase auth UID."
            },
            {
              "name": "tradeLogId",
              "description": "The unique identifier for the trade log entry."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/dailyAnalyses/{dailyAnalysisId}",
        "definition": {
          "entityName": "DailyAnalysis",
          "schema": {
            "$ref": "#/backend/entities/DailyAnalysis"
          },
          "description": "Stores daily analysis reports generated by AI for a given user.  Path-based ownership enforced via security rules.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user. Corresponds to the Firebase auth UID."
            },
            {
              "name": "dailyAnalysisId",
              "description": "The unique identifier for the daily analysis report."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/weeklyReviews/{weeklyReviewId}",
        "definition": {
          "entityName": "WeeklyReview",
          "schema": {
            "$ref": "#/backend/entities/WeeklyReview"
          },
          "description": "Stores weekly review and pattern discovery reports for a given user. Path-based ownership enforced via security rules.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user. Corresponds to the Firebase auth UID."
            },
            {
              "name": "weeklyReviewId",
              "description": "The unique identifier for the weekly review report."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/weeklyReviews/{weeklyReviewId}/weeklyImprovementPlan",
        "definition": {
          "entityName": "WeeklyImprovementPlan",
          "schema": {
            "$ref": "#/backend/entities/WeeklyImprovementPlan"
          },
          "description": "Stores the weekly improvement plan generated by AI, associated with a specific weekly review. Path-based ownership enforced via security rules.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user. Corresponds to the Firebase auth UID."
            },
            {
              "name": "weeklyReviewId",
              "description": "The unique identifier for the weekly review report to which this plan belongs."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/monthlySummaries/{monthlySummaryId}",
        "definition": {
          "entityName": "MonthlySummary",
          "schema": {
            "$ref": "#/backend/entities/MonthlySummary"
          },
          "description": "Stores monthly summaries and system optimization reports for a given user. Path-based ownership enforced via security rules.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user.  Corresponds to the Firebase auth UID."
            },
            {
              "name": "monthlySummaryId",
              "description": "The unique identifier for the monthly summary report."
            }
          ]
        }
      }
    ],
    "reasoning": "This design prioritizes user data isolation in a multi-tenant environment by using path-based ownership. Each user's data is stored under a dedicated `/users/{userId}` path, ensuring data segregation and straightforward security rules. A user's subscription is stored in a singleton document `/users/{userId}/subscription/current` for efficient lookup to control feature access. This approach also aligns with the principle of Authorization Independence, as access control can be directly enforced based on the `request.auth.uid` and the path structure, avoiding the need for `get()` calls to parent documents for authorization."
  }
}
