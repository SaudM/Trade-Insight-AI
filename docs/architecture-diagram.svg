<?xml version="1.0" encoding="UTF-8"?>
<svg width="1200" height="900" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>
      .title { font-family: 'Arial', sans-serif; font-size: 24px; font-weight: bold; fill: #2c3e50; }
      .subtitle { font-family: 'Arial', sans-serif; font-size: 16px; font-weight: bold; fill: #34495e; }
      .text { font-family: 'Arial', sans-serif; font-size: 12px; fill: #2c3e50; }
      .small-text { font-family: 'Arial', sans-serif; font-size: 10px; fill: #7f8c8d; }
      .layer-bg { fill: #ecf0f1; stroke: #bdc3c7; stroke-width: 2; }
      .component-bg { fill: #ffffff; stroke: #3498db; stroke-width: 2; }
      .ai-component { fill: #e8f5e8; stroke: #27ae60; stroke-width: 2; }
      .firebase-component { fill: #fff3cd; stroke: #f39c12; stroke-width: 2; }
      .api-component { fill: #e3f2fd; stroke: #2196f3; stroke-width: 2; }
      .arrow { stroke: #e74c3c; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
      .data-flow { stroke: #9b59b6; stroke-width: 2; fill: none; marker-end: url(#arrowhead); stroke-dasharray: 5,5; }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#e74c3c" />
    </marker>
  </defs>
  
  <!-- 标题 -->
  <text x="600" y="30" text-anchor="middle" class="title">Trade Insight AI - 系统架构图</text>
  
  <!-- 前端层 -->
  <rect x="50" y="60" width="1100" height="180" class="layer-bg" rx="10"/>
  <text x="70" y="85" class="subtitle">前端层 (Frontend Layer)</text>
  
  <!-- Next.js 应用 -->
  <rect x="80" y="100" width="200" height="120" class="component-bg" rx="5"/>
  <text x="180" y="125" text-anchor="middle" class="subtitle">Next.js 15.3.3</text>
  <text x="90" y="145" class="text">• React 18.3.1</text>
  <text x="90" y="160" class="text">• TypeScript 5</text>
  <text x="90" y="175" class="text">• Tailwind CSS</text>
  <text x="90" y="190" class="text">• Radix UI 组件</text>
  <text x="90" y="205" class="text">• 主题切换支持</text>
  
  <!-- 页面组件 -->
  <rect x="320" y="100" width="180" height="120" class="component-bg" rx="5"/>
  <text x="410" y="125" text-anchor="middle" class="subtitle">页面组件</text>
  <text x="330" y="145" class="text">• 登录/注册页面</text>
  <text x="330" y="160" class="text">• 个人中心</text>
  <text x="330" y="175" class="text">• 订阅管理</text>
  <text x="330" y="190" class="text">• 交易日志</text>
  <text x="330" y="205" class="text">• AI 分析报告</text>
  
  <!-- UI 组件库 -->
  <rect x="540" y="100" width="180" height="120" class="component-bg" rx="5"/>
  <text x="630" y="125" text-anchor="middle" class="subtitle">UI 组件库</text>
  <text x="550" y="145" class="text">• Radix UI 基础组件</text>
  <text x="550" y="160" class="text">• 自定义业务组件</text>
  <text x="550" y="175" class="text">• 图表组件 (Recharts)</text>
  <text x="550" y="190" class="text">• 表单组件</text>
  <text x="550" y="205" class="text">• 主题提供者</text>
  
  <!-- 状态管理 -->
  <rect x="760" y="100" width="180" height="120" class="component-bg" rx="5"/>
  <text x="850" y="125" text-anchor="middle" class="subtitle">状态管理</text>
  <text x="770" y="145" class="text">• React Hook Form</text>
  <text x="770" y="160" class="text">• Firebase Hooks</text>
  <text x="770" y="175" class="text">• 自定义 Hooks</text>
  <text x="770" y="190" class="text">• Context API</text>
  <text x="770" y="205" class="text">• 错误处理</text>
  
  <!-- 工具库 -->
  <rect x="980" y="100" width="150" height="120" class="component-bg" rx="5"/>
  <text x="1055" y="125" text-anchor="middle" class="subtitle">工具库</text>
  <text x="990" y="145" class="text">• Zod 验证</text>
  <text x="990" y="160" class="text">• Date-fns</text>
  <text x="990" y="175" class="text">• Axios HTTP</text>
  <text x="990" y="190" class="text">• QR Code</text>
  <text x="990" y="205" class="text">• Lucide Icons</text>
  
  <!-- API 层 -->
  <rect x="50" y="270" width="1100" height="140" class="layer-bg" rx="10"/>
  <text x="70" y="295" class="subtitle">API 层 (API Layer)</text>
  
  <!-- Next.js API Routes -->
  <rect x="80" y="310" width="250" height="80" class="api-component" rx="5"/>
  <text x="205" y="335" text-anchor="middle" class="subtitle">Next.js API Routes</text>
  <text x="90" y="355" class="text">• /api/orders - 订单管理</text>
  <text x="90" y="370" class="text">• /api/subscription/* - 订阅服务</text>
  <text x="90" y="385" class="text">• 微信支付集成</text>
  
  <!-- AI 服务层 -->
  <rect x="370" y="310" width="250" height="80" class="ai-component" rx="5"/>
  <text x="495" y="335" text-anchor="middle" class="subtitle">AI 服务层</text>
  <text x="380" y="355" class="text">• Google Genkit AI</text>
  <text x="380" y="370" class="text">• AI 分析流程</text>
  <text x="380" y="385" class="text">• 智能报告生成</text>
  
  <!-- 支付服务 -->
  <rect x="660" y="310" width="200" height="80" class="component-bg" rx="5"/>
  <text x="760" y="335" text-anchor="middle" class="subtitle">支付服务</text>
  <text x="670" y="355" class="text">• 微信支付 V3</text>
  <text x="670" y="370" class="text">• 订单处理</text>
  <text x="670" y="385" class="text">• 支付回调</text>
  
  <!-- 认证服务 -->
  <rect x="900" y="310" width="200" height="80" class="firebase-component" rx="5"/>
  <text x="1000" y="335" text-anchor="middle" class="subtitle">Firebase Auth</text>
  <text x="910" y="355" class="text">• 用户认证</text>
  <text x="910" y="370" class="text">• 会话管理</text>
  <text x="910" y="385" class="text">• 权限控制</text>
  
  <!-- 数据层 -->
  <rect x="50" y="440" width="1100" height="200" class="layer-bg" rx="10"/>
  <text x="70" y="465" class="subtitle">数据层 (Data Layer)</text>
  
  <!-- Firestore 数据库 -->
  <rect x="80" y="480" width="300" height="140" class="firebase-component" rx="5"/>
  <text x="230" y="505" text-anchor="middle" class="subtitle">Cloud Firestore</text>
  <text x="90" y="525" class="text">数据结构:</text>
  <text x="90" y="545" class="text">• /users/{userId} - 用户信息</text>
  <text x="90" y="560" class="text">• /users/{userId}/tradeLogs - 交易日志</text>
  <text x="90" y="575" class="text">• /users/{userId}/dailyAnalyses - 日分析</text>
  <text x="90" y="590" class="text">• /users/{userId}/weeklyReviews - 周报告</text>
  <text x="90" y="605" class="text">• /users/{userId}/orders - 订单数据</text>
  
  <!-- 数据访问层 -->
  <rect x="420" y="480" width="250" height="140" class="component-bg" rx="5"/>
  <text x="545" y="505" text-anchor="middle" class="subtitle">数据访问层</text>
  <text x="430" y="525" class="text">• useCollection Hook</text>
  <text x="430" y="540" class="text">• useDoc Hook</text>
  <text x="430" y="555" class="text">• Firebase Admin SDK</text>
  <text x="430" y="570" class="text">• 实时数据同步</text>
  <text x="430" y="585" class="text">• 错误处理</text>
  <text x="430" y="600" class="text">• 权限验证</text>
  
  <!-- 安全规则 -->
  <rect x="710" y="480" width="200" height="140" class="firebase-component" rx="5"/>
  <text x="810" y="505" text-anchor="middle" class="subtitle">Firestore 规则</text>
  <text x="720" y="525" class="text">• 用户所有权验证</text>
  <text x="720" y="540" class="text">• 严格访问控制</text>
  <text x="720" y="555" class="text">• 数据隔离</text>
  <text x="720" y="570" class="text">• 防止枚举攻击</text>
  <text x="720" y="585" class="text">• 读写权限分离</text>
  
  <!-- 缓存层 -->
  <rect x="950" y="480" width="180" height="140" class="component-bg" rx="5"/>
  <text x="1040" y="505" text-anchor="middle" class="subtitle">缓存策略</text>
  <text x="960" y="525" class="text">• Firebase 本地缓存</text>
  <text x="960" y="540" class="text">• React Query 缓存</text>
  <text x="960" y="555" class="text">• 离线支持</text>
  <text x="960" y="570" class="text">• 数据同步</text>
  <text x="960" y="585" class="text">• 性能优化</text>
  
  <!-- AI 处理层 -->
  <rect x="50" y="670" width="1100" height="120" class="layer-bg" rx="10"/>
  <text x="70" y="695" class="subtitle">AI 处理层 (AI Processing Layer)</text>
  
  <!-- AI 分析流程 -->
  <rect x="80" y="710" width="200" height="60" class="ai-component" rx="5"/>
  <text x="180" y="735" text-anchor="middle" class="subtitle">AI 分析流程</text>
  <text x="90" y="755" class="text">• 日常交易分析</text>
  <text x="90" y="770" class="text">• 周期性模式发现</text>
  
  <rect x="320" y="710" width="200" height="60" class="ai-component" rx="5"/>
  <text x="420" y="735" text-anchor="middle" class="subtitle">报告生成</text>
  <text x="330" y="755" class="text">• 月度绩效评估</text>
  <text x="330" y="770" class="text">• 改进建议生成</text>
  
  <rect x="560" y="710" width="200" height="60" class="ai-component" rx="5"/>
  <text x="660" y="735" text-anchor="middle" class="subtitle">系统优化</text>
  <text x="570" y="755" class="text">• 迭代建议</text>
  <text x="570" y="770" class="text">• 智能推荐</text>
  
  <rect x="800" y="710" width="200" height="60" class="ai-component" rx="5"/>
  <text x="900" y="735" text-anchor="middle" class="subtitle">Google Genkit</text>
  <text x="810" y="755" class="text">• AI 模型集成</text>
  <text x="810" y="770" class="text">• 流程编排</text>
  
  <!-- 外部服务 -->
  <rect x="50" y="820" width="1100" height="60" class="layer-bg" rx="10"/>
  <text x="70" y="845" class="subtitle">外部服务 (External Services)</text>
  
  <rect x="80" y="850" width="150" height="25" class="component-bg" rx="3"/>
  <text x="155" y="867" text-anchor="middle" class="text">微信支付 API</text>
  
  <rect x="270" y="850" width="150" height="25" class="component-bg" rx="3"/>
  <text x="345" y="867" text-anchor="middle" class="text">Google AI API</text>
  
  <rect x="460" y="850" width="150" height="25" class="component-bg" rx="3"/>
  <text x="535" y="867" text-anchor="middle" class="text">Firebase 服务</text>
  
  <rect x="650" y="850" width="150" height="25" class="component-bg" rx="3"/>
  <text x="725" y="867" text-anchor="middle" class="text">CDN 服务</text>
  
  <!-- 数据流箭头 -->
  <!-- 前端到API -->
  <line x1="180" y1="220" x2="205" y2="310" class="arrow"/>
  <line x1="410" y1="220" x2="495" y2="310" class="arrow"/>
  <line x1="630" y1="220" x2="760" y2="310" class="arrow"/>
  <line x1="850" y1="220" x2="1000" y2="310" class="arrow"/>
  
  <!-- API到数据层 -->
  <line x1="205" y1="390" x2="230" y2="480" class="arrow"/>
  <line x1="495" y1="390" x2="545" y2="480" class="arrow"/>
  <line x1="760" y1="390" x2="810" y2="480" class="arrow"/>
  <line x1="1000" y1="390" x2="1040" y2="480" class="arrow"/>
  
  <!-- AI流程 -->
  <line x1="495" y1="390" x2="420" y2="710" class="data-flow"/>
  <line x1="545" y1="620" x2="660" y2="710" class="data-flow"/>
  
  <!-- 图例 -->
  <rect x="50" y="890" width="300" height="5" fill="none"/>
  <text x="60" y="905" class="small-text">图例:</text>
  <line x1="100" y1="900" x2="130" y2="900" class="arrow"/>
  <text x="135" y="905" class="small-text">API 调用</text>
  <line x1="200" y1="900" x2="230" y2="900" class="data-flow"/>
  <text x="235" y="905" class="small-text">数据流</text>
</svg>